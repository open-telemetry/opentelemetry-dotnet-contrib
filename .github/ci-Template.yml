name: build-test

on:
  pull_request:
    branches: [ 'main*', 'instrumentation*', 'exporter*', 'extensions*' ]
    paths:
      - 'modules/{{moduleName}}/**'

jobs:
  {{moduleName}}:
    uses: ./.github/workflows/build-module.yml
    with:
      module-name: {{moduleName}}
      module-directory: 'modules/{{moduleName}}'

  build-test:
    needs: [
      {{moduleName}}
    ]
    if: always() && !cancelled()
    runs-on: ubuntu-22.04
    steps:
    - run: |
          if ( ${{ contains(needs.*.result, 'failure') }} == true ); then echo 'build failed ✗'; exit 1; else echo 'build complete ✓'; fi
